<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Unknown </title></head><body>
<p># Agile High-Level Design (HLD) for Parking Space Availability System</p>
<blockquote>
<p>Portions generated by ChatGPT-4 prompted to act like a senior software engineer.</p>
</blockquote>
<p>This high-level design provides an outline of the main objects and classes, as well as technical tips on using MQTT and the Raspberry Pi SenseHAT joystick and display. This information serves as a starting point for the junior developer responsible for implementing the code.</p>
<h2 id="additional-requirement-pep8-compliance">Additional Requirement: PEP8 Compliance</h2>
<p>The project must follow PEP8, the Python style guide, to ensure consistency and readability throughout the codebase.</p>
<h2 id="objects-and-classes">Objects and Classes</h2>
<h3 id="class-parkinglot">Class: ParkingLot</h3>
<p>Attributes:</p>
<ul>
<li>location: The parking lot's location.</li>
<li>total_spaces: The total number of parking spaces.</li>
<li>available_spaces: The number of available parking spaces.</li>
<li>mqtt_client: The MQTT client to send and receive messages.</li>
</ul>
<p>Methods: 
- <code>__init__(self, config)</code>: Initialize the ParkingLot object with the given configuration.
- <code>enter(self)</code>: Register a car entering the parking lot.
- <code>exit(self)</code>: Register a car leaving the parking lot.
- <code>publish_update(self)</code>: Publish an update containing available_spaces, temperature, and time.</p>
<h3 id="class-sensor">Class: Sensor</h3>
<p>Attributes:</p>
<ul>
<li>sense_hat: The SenseHAT object to control the sensors.</li>
</ul>
<p>Methods: </p>
<ul>
<li><code>__init__(self)</code>: Initialize the Sensor object with a SenseHAT instance.</li>
<li><code>read_temperature(self)</code>: Read the temperature from the SenseHAT sensor.</li>
</ul>
<h3 id="class-display">Class: Display</h3>
<p>Attributes:</p>
<ul>
<li>sense_hat: The SenseHAT object to control the LED display.</li>
</ul>
<p>Methods: </p>
<ul>
<li><code>__init__(self)</code>: Initialize the Display object with a SenseHAT instance.</li>
<li><code>show_message(self, message)</code>: Display a message on the LED display.</li>
</ul>
<h2 id="class-diagram">Class Diagram</h2>
<p>```mermaid</p>
<p>classDiagram
    ParkingLot --&gt; Display : updates (via MQTT)
    class ParkingLot {
        +location: str
        +total_spaces: int
        +available_spaces: int
        +mqtt_client: MQTTClient
        +enter(): None
        +exit(): None
        +publish_update(): None
    }
    class Sensor {
        +sense_hat: SenseHAT
        +read_temperature(): float
    }
    class Display {
        +sense_hat: SenseHAT
        +show_message(message: str): None
    }
```</p>
<h2 id="technical-guidance">Technical Guidance</h2>
<h3 id="mqtt">MQTT</h3>
<ul>
<li>Install the <code>paho-mqtt</code> library by running <code>pip install paho-mqtt</code>.</li>
<li>Import the library in your code using <code>import paho.mqtt.client as mqtt</code>.</li>
<li>Create an MQTT client instance: <code>client = mqtt.Client()</code>.</li>
<li>Connect the client to the MQTT broker using the provided host and port: <code>client.connect(broker_host, broker_port)</code>.</li>
<li>Subscribe to a topic to receive messages: <code>client.subscribe("topic_name")</code>.</li>
<li>Define a callback function to handle received messages: <code>def on_message(client, userdata, message): ....</code></li>
<li>Assign the callback function to the client: <code>client.on_message = on_message</code>.</li>
<li>Start the client loop to process network traffic: <code>client.loop_start()</code>.</li>
</ul>
<h3 id="sensehat-joystick">SenseHAT Joystick</h3>
<ul>
<li>Import the SenseHAT library: <code>from sense_hat import SenseHat</code>.</li>
<li>Create a SenseHAT instance: <code>sense = SenseHat()</code>.</li>
<li>Define a function to handle joystick events: <code>def handle_joystick(event): ....</code></li>
<li>Check the event's action (e.g., <code>event.action == "pressed"</code>) and direction (e.g., <code>event.direction == "up"</code>).</li>
<li>Register the function as an event handler: <code>sense.stick.direction_up = handle_joystick</code>.</li>
</ul>
<h3 id="sensehat-display">SenseHAT Display</h3>
<ul>
<li>Use the <code>sense.show_message()</code> method to display text on the LED display (e.g., <code>sense.show_message("Hello, World!")</code>).</li>
<li>Configure the text scroll speed, text color, and background color using optional parameters:
For example: <code>sense.show_message("Hello, World!", scroll_speed=0.1, text_colour=(255, 255, 255), back_colour=(0, 0, 0))</code>).</li>
</ul>
<h2 id="pep8-examples">PEP8 Examples</h2>
<h3 id="separate-words-with-underscores">Separate words with underscores</h3>
<p>Incorrect:</p>
<p>```python</p>
<p>def someFunction():
    return</p>
<p>someVariable = 42
```</p>
<p>Correct:</p>
<p>```python</p>
<p>def some_function():
    return</p>
<p>some_variable = 42
```</p>
<h3 id="use-full-english-words-wherever-possible-not-contractions">Use full English words wherever possible, not contractions</h3>
<p>Incorrect:</p>
<p>```python</p>
<p>def calc_avg(numbers):
    return sum(numbers) / len(numbers)</p>
<p>temp = calc_avg([1, 2, 3])
```</p>
<p>Correct:</p>
<p>```python</p>
<p>def calculate_average(numbers):
    return sum(numbers) / len(numbers)</p>
<p>temperature = calculate_average([1, 2, 3])
```</p>
<h3 id="do-not-put-a-space-between-a-function-name-and-the-bracket">Do not put a space between a function name and the bracket</h3>
<p>Incorrect:</p>
<p>```python</p>
<p>def some_function ():
    return
```</p>
<p>Correct:</p>
<p>```python</p>
<p>def some_function():
    return
```</p>
<h2 id="configuration-file-parsing">Configuration File Parsing</h2>
<blockquote>
<p><strong>Lecturer's note</strong>: There is a lot of flexibility here. The key is that the configuration <em>must</em> be in a text file and it <em>must</em> have an attribute value format of some kind.</p>
</blockquote>
<p>To parse the TOML configuration file, follow these steps:</p>
<ol>
<li>Install the <code>tomli</code> library by running <code>pip install tomli</code>.</li>
<li>Import the library in your code using <code>import tomli</code>.</li>
<li>Read the contents of the configuration file into a string.</li>
<li>Use the <code>tomli.loads()</code> method to parse the string and create a dictionary.</li>
</ol>
<p>Note: In 3.11, toml (tomllib) is built in, see:
<a href="https://docs.python.org/3/library/tomllib.html">python docs</a>
Example:</p>
<p>```python</p>
<p>import tomli</p>
<p>with open("config.toml", "r") as file:
    config_string = file.read()</p>
<p>config = tomli.loads(config_string)
```</p>
<p>The resulting <code>config</code> dictionary can then be used to initialize the <code>ParkingLot</code>, <code>Sensor</code>, and <code>Display</code> objects.</p>
<h2 id="sensor-class">Sensor Class</h2>
<p>To encapsulate the SenseHAT, create a <code>Sensor</code> class:</p>
<p>Class: Sensor
Attributes:</p>
<ul>
<li>sense_hat: The SenseHAT object to access the sensor data.</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>__init__(self)</code>: Initialize the Sensor object with a SenseHAT instance.</li>
<li><code>get_temperature(self)</code>: Retrieve the current temperature from the SenseHAT.</li>
</ul>
<p>Example:</p>
<p>```python</p>
<p>from sense_hat import SenseHat</p>
<p>class Sensor:
    def <strong>init</strong>(self):
        self.sense_hat = SenseHat()</p>
<pre><code>def get_temperature(self):
    return self.sense_hat.get_temperature()
</code></pre>
<p>```</p>
<h2 id="test-cases">Test Cases</h2>
<p>For the unittest module, you can create test cases that cover the parsing of the configuration file and the logic of the parking lot. Here are some example test cases:</p>
<ol>
<li>Test that the configuration file is parsed correctly:</li>
</ol>
<p>```python</p>
<p>import unittest
import tomli
from parking_lot import parse_config</p>
<p>class TestConfigParsing(unittest.TestCase):
    def test_parse_config(self):
        config_string = '''
        [parking_lot]
        location = "Moondalup City Square Parking"
        total_spaces = 192
        broker_host = "localhost"
        broker_port = 1883
        '''
        config = tomli.loads(config_string)
        parking_lot = parse_config(config)
        self.assertEqual(parking_lot.location, "Moondalup City Square Parking")
        self.assertEqual(parking_lot.total_spaces, 192)
```</p>
<ol>
<li>Test that the available spaces do not go below zero:</li>
</ol>
<p>```python</p>
<p>import unittest
from parking_lot import ParkingLot</p>
<p>class TestParkingLot(unittest.TestCase):
    def test_no_negative_spaces(self):
        parking_lot = ParkingLot("Test Location", 2, "localhost", 1883)
        parking_lot.available_spaces = 0
        parking_lot.enter()
        parking_lot.enter()
        self.assertEqual(parking_lot.available_spaces, 0)
        parking_lot.exit()
        parking_lot.exit()
        parking_lot.exit()
        self.assertEqual(parking_lot.available_spaces, 1)
```</p>
<h2 id="alternative-if-you-dont-have-a-sensehat">Alternative: If You Don't Have a SenseHAT</h2>
<p>Replace the SenseHAT with a Tkinter-based interface for simulating joystick events and displaying the parking lot information. </p>
<blockquote>
<p><strong>Lecturer's note</strong>: code <code>no_pi.py</code> has already been provided that implements a more advanced version of this for you.</p>
</blockquote>
<h3 id="dependencies">Dependencies</h3>
<p>For this alternative, there is no need for a Sensor class, as the temperature and other sensor data will be simulated.</p>
<h3 id="display-class">Display Class</h3>
<p>Replace the Display class with a Tkinter-based class (starting code has been included).</p>
<p>Class: TkinterDisplay</p>
<p>Attributes:
- root: The Tkinter root window.
- label: The Tkinter label to display the parking lot information.</p>
<p>Methods: 
- <code>__init__(self)</code>: Initialize the TkinterDisplay object.
- <code>show_message(self, message)</code>: Display a message on the Tkinter label.</p>
<p>Example:</p>
<p>```python</p>
<p>import tkinter as tk</p>
<p>class TkinterDisplay:
    def <strong>init</strong>(self):
        self.root = tk.Tk()
        self.label = tk.Label(self.root, text="", width=50, height=5)
        self.label.pack()</p>
<pre><code>def show_message(self, message):
    self.label.config(text=message)
    self.root.update()
</code></pre>
<p>```</p>
<h3 id="joystick-events-simulation">Joystick Events Simulation</h3>
<p>Use Tkinter buttons to simulate joystick events, such as "enter" and "exit" for the parking lot.</p>
<p>```python</p>
<p>def on_enter_button_click():
    parking_lot.enter()</p>
<p>def on_exit_button_click():
    parking_lot.exit()</p>
<p>enter_button = tk.Button(root, text="Enter", command=on_enter_button_click)
exit_button = tk.Button(root, text="Exit", command=on_exit_button_click)
enter_button.pack()
exit_button.pack()
```</p>
<h2 id="alternative-2-text-file-for-for-screen-reader-compatibility">Alternative 2: Text File for for Screen Reader Compatibility</h2>
<p>Create an alternative solution where the parking lot information is updated in a text file, allowing access to the information using a screen reader.</p>
<h3 id="text-display-class">Text Display Class</h3>
<p>Replace the Display class with a class that writes the parking lot information to a text file.</p>
<p>Class: TextFileDisplay
Attributes:</p>
<ul>
<li>file_path: The path to the text file.</li>
</ul>
<p>Methods:</p>
<ul>
<li><code>__init__(self, file_path)</code>: Initialize the TextFileDisplay object with the given file path.</li>
<li><code>show_message(self, message)</code>: Write the parking lot information to the text file.</li>
</ul>
<p>Example:</p>
<p>```python</p>
<p>class TextFileDisplay:
    def <strong>init</strong>(self, file_path):
        self.file_path = file_path</p>
<pre><code>def show_message(self, message):
    with open(self.file_path, "w") as file:
        file.write(message)
</code></pre>
<p>```</p>
<h3 id="joystick-events-simulation-from-console-input">Joystick Events Simulation From Console Input</h3>
<p>For this alternative, simulate joystick events by reading user input from the console.</p>
<p>```python</p>
<p>while True:
    action = input("Enter 'e' for car entering, 'x' for car exiting, or 'q' to quit: ").lower()
    if action == 'e':
        parking_lot.enter()
    elif action == 'x':
        parking_lot.exit()
    elif action == 'q':
        break
```</p>
</body></html>